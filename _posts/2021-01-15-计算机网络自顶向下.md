---
layout: post
title: "计算机网络自顶向下"
---

# 计算机网络自顶向下

## 1 计算机网络和因特网

端系统通过**通信链路**和**分组交换机**连接在一起。

分组交换机将从链路收到的分组（将信息分段并加上首字母的信息包）再通过链路进行转发。常见的分组交换机有：*路由器，链路层交换机*-接入网络。

一个分组经历的链路和分组交换机称为路径。

TCP (transmission control protocol 传输控制协议)。

IP(internet protocol 网际协议)：定义了在路由器和端系统之间发送和接收的分组格式。

### 1.3 网络核心

#### 1.3.1 分组交换

一份信息会被划分成几个小块，称为分组。分组通过链路和分组交换机传送，传送的速度是链路的最大传送速率。所以，若一个分组大小是L比特，链路的传输速率是R比特/秒，则传输的时间是L/R秒。

- **存储转发传输**

  交换机输出分组之前必须先接收到所有分组。因此会有一个储存的过程。所以一个分组只经过一个交换机，两条链路，全部传输的时间是2*L/R秒。

- **排队时延和分组丢失**

  对于每一条链路，分组交换机都对它有一个输出缓存（输出队列）。如果这一块缓存被填满了，但是还有包在进入，那么会丢包。

- **转发表和路由选择协议**

  通过IP选择向哪个端系统转发，转发表可以自动分配。

#### 1.3.2 电路交换

移动数据有两种方法：分组交换、电路交换。电路交换会预约链路的一部分作为其专属，若一条链路有4条**电路**，则申请其1/4，分组在电路上的传输速率是R/4。

- **电路交换网络中的复用**

  上一段中电路的实现有两种方式：***频分复用-FDM***，***时分复用-TDM***。

  FDM：链路上划分频率，每条电路占一个频段。宽度通常为4kHz。

  TDM：时间上划分固定时长为帧。，每个帧被划分为固定数量的时隙，每个时隙就是一条电路。因为是在时间上划分帧，所以时间维度上的每一帧都是同一个帧的不同时间，所以所有帧划分的时隙数量一样，且帧A的时隙C=帧B的时隙C。

- **分组交换与电路交换的对比**

#### 1.3.3 网络的网络

PoP：提供商网络中的一台或多台路由器群组。

多宿：一个客户连接多个提供商。

对等：同一级别，信息传输不交费。

因特网交换点IXP：多个ISP可在这里对等。用于ISP们直接交换数据，避免向更高层的ISP交费，IXP计算流量赚钱。

### 1.4 分组交换网中的时延、丢包和吞吐量

#### 1.4.1 分组交换网中的时延概述

- **时延的类型**

  - 处理时延
- 排队时延
  - 传输时延
- 传播时延
  
> 传输时延指路由器推出分组需要的时间，传播时延指走实际链路长度需要的时间。

#### 1.4.2 排队时延和丢包

排队时延与传输速率有关。排队时延与**流量强度**（L*a/R）正相关。a是分组到达队列的平均速度。

#### 1.4.3 端到端时延

- **traceroute**

  会返回n值----第n台路由，路由器名字，路由器地址，3列往返时延。

- **端系统，应用程序和其他时延**

#### 1.4.4 计算机网络中的吞吐量

吞吐量是链路中最小的吞吐量。

### 1.5 协议层次及其服务模型

#### 1.5.1 分层的体系结构

- **协议分层**

  有协议栈。

  5层：自顶向下：应用层，运输层，网络层，链路层，物理层。

  7层：应用层，表示层，会话层，运输层，网络层，数据链路层，物理层。

#### 1.5.2 封装

封装指，将来自上一层的信息进行封装，并附上自己这一层的开头，就像是包装东西一样。

## 2 应用层

### 2.1 应用层协议原理

#### 2.1.1 网络应用程序体系结构

**客户-服务器体系结构：**

**P2P体系结构：**对等体系结构，主机之间互相直接进行通信。

#### 2.1.2 进程通信

每个程序都是运行在电脑上的一个进程。所以端与端之间的通信是不同端上的进程间的通信。

- **客户和服务端进程**

  发起会话的是客户端进程，等待的是服务器进程。

- **进程与计算机网络之间的接口**

  进程通过socket像网络发送或者接收报文。socket就像门。

- **进程寻址**

  A向B发送分组，需要选择B用于接收该分组的进程，所以接收进程需要有一个地址。为了标识该接收进程，需要定义两种信息：主机的地址，和，在目的主机中指定接收进程的标识符。

  主机由IP标识。

  接收进程由端口号标识。

#### 2.1.3 可供应用程序使用的运输服务

根据自己的需求，从：可靠数据传输、吞吐量、定时、安全性，4个方面选择适合应用的运输层协议。

- **可靠数据传输**

- **吞吐量**
- **定时：**对实时交互很重要

- **安全性**

#### 2.1.4 因特网提供的运输服务

- **TCP服务：**面向连接服务，可靠数据传输服务。

  面向连接服务：握手。

- **UDP服务：**无连接，不可靠。

- **因特网运输协议所不提供的服务：**未提供吞吐量和定时保证。

#### 2.1.5 应用层协议

定义了如何互相传递报文，包括报文的类型，报文的语法，何时发送，相应的规则等。

### 2.2 Web和HTTP

#### 2.2.1 HTTP概况

Web的应用层协议是**超文本传输协议HTTP**。HTTP由客户程序和服务器程序实现。它们通过交换HTTP报文进行通话，HTTP定义了报文的交换方式和结构。HTTP使用TCP作为它的支撑运输协议。HTTP不记录客户端状态，是一个无状态协议。

#### 2.2.2 非持续连接和持续连接

当一个客户端发出一系列请求，服务器可以决定是将这些请求的响应每个都经一个单独的TCP连接发送（**非持续连接**），还是所有的响应都经相同的TCP连接发送（**持续连接**）。

- **采用非持续连接的HTTP**

  一个页面可能包含有多个对象，如：1个html基本文件，10个jpeg图形。非持续连接的每个tcp连接不会为其他的对象持续下来，所以对于上面的例子，需要11个tcp连接。

- **采用持续连接的HTTP**

  也可以打开多个tcp。

#### 2.2.3 HTTP报文格式

- **HTTP请求报文**
- **HTTP响应报文**

#### 2.2.4 用户和服务器的交互：cookie

#### 2.2.5 Web缓存

Web缓存器也叫代理服务器。

#### 2.2.6 条件GET方法

考虑到代理服务器上的副本不是原件，原件在之后可能有一定的修改。所以设计了**条件GET方法**，用于检查副本是否过期。当用户发送请求的时候，代理服务器如果拥有副本，则会向服务器发送一个"If-modified-since: "+上次copy的时间，如果和原件中的"Last-Modified"一样，即未被修改，那么服务器向代理服务器发送一个不包含对象的响应报文，通知"Not Modified"。

### 2.3 因特网中的电子邮件

电子邮件系统包含3个主要组成部分：用户代理，邮件服务器，简单邮件传输协议-SMTP。

邮件服务器是电子邮件体系结构的核心。每个接收方在邮件服务器上都有一个邮箱。

#### 2.3.1 SMTP

SMTP是因特网电子邮件的核心。SMTP一般不使用中间邮件服务器，如果一方邮件服务器关机，那么报文会保留在发送者的邮件服务器上，并等待新的尝试。SMTP是持续连接。

#### 2.3.2 与HTTP的对比

HTTP是一个拉协议。SMTP是一个推协议。

#### 2.3.3 邮件报文格式

#### 2.3.4 邮件访问协议

- POP3

  用户代理打开了一个到邮件服务器端口110上的TCP连接之后，POP验证用户身份，用户代理取回报文并进行操作，如：删除等，然后quit，POP对用户代理的操作进行相应处理。

- IMAP

  IMAP将每个报文与一个文件夹联系起来，为用户提供了在远程文件夹中查询邮件的命令。

- 基于Web的电子邮件

### 2.4 DNS：因特网的目录服务

IP地址由4字节组成。

#### 2.4.1 DNS提供的服务

域名系统DNS能将主机名转换成IP地址。DNS是一个由分层的DNS服务器实现的分布式数据库，一个使主机能够查询分布式数据库的应用层协议。DNS协议运行在UDP上，使用53号端口。

#### 2.4.2 DNS工作机理概述

- 分布式、层次数据库

  权威DNS服务器：问的时候先获取权威DNS服务器的IP，然后再直接向权威DNS服务器询问IP。

- DNS缓存

  和Web缓存类似，但是固定时间之后会丢弃缓存。

#### 2.4.3 DNS记录和报文

- DNS报文
- 在DNS数据库中插入记录

### 2.5 P2P文件分发

每个对等方可以给另一个对等方传文件，减少客户端-服务器模式下服务器的压力。

- P2P体系结构的扩展性
- BitTorrent

### 2.6 视频流和内容分发网

#### 2.6.1 因特网视频

#### 2.6.2 HTTP流和DASH

#### 2.6.3 内容分发网

### 2.7 套接字编程：生成网络应用

#### 2.7.1 UDP套接字编程

#### 2.7.2 TCP套接字编程

## 3 运输层

### 3.1 概述和运输层服务

运输层协议是由端系统实现的，而不是由路由器实现的。

#### 3.1.1 运输层和网络层的关系

#### 3.1.2 因特网运输层概述

因特网网络层有一个协议，IP。IP是不可靠服务。

### 3.2 多路复用和多路分解

多路分解：将运输层报文段中的数据交付到正确的套接字。

多路复用：从不同套接字中收集数据块并封装，然后传递到网络层。

- 无连接的多路复用和多路分解

  二元组，源端口号，目的端口号。同一个目的端口号的报文，导到同一个套接字。

- 面向连接的多路复用和多路分解

  四元组，源IP地址，源端口号，目的IP地址，目的端口号。两个不同源IP或源端口号，将导到两个不同的套接字。

- Web服务器与TCP

  一个端口可以有多个套接字。

### 3.3 无连接运输：UDP

UDP除了复用分解和少量的差错检测外，和IP几乎没有区别。

#### 3.3.1 UDP报文段结构

#### 3.3.2 UDP检验和

### 3.4 可靠数据传输原理

#### 3.4.1 构造可靠数据传输协议

- 经完全可靠信道的可靠数据传输：rdt1.0

- 经具有比特差错信道的可靠数据传输：rdt2.0

  这种模型与上面的相比，在传输过程中可能出现比特受损。

  **自动重传请求协议。ARQ。**

- 经具有比特差错的丢包信道的可靠数据传输：rdt3.0

  和上面的相比还会丢包。

#### 3.4.2 流水线可靠数据传输协议

#### 3.4.3 回退N步GBN

也称滑动窗口协议。分组不是无限制发送，其许可序号为N。

#### 3.4.4 选择重传

### 3.5 面向连接的运输：TCP

#### 3.5.1 TCP连接

#### 3.5.2 TCP报文段结构

- 序号和确认号

  报文段不等于字节流划分的数据段。一个报文段可以有很多数据段。序号是给数据段编号的。确认号填写的是下一个所需字节的序号，这个序号的排序取决于对面。

#### 3.5.3 往返时间的估计与超时

#### 3.5.4 可靠数据传输

## 4 网络层：数据平面

### 4.1 网络层概述

### 4.2 路由器工作原理

## 5 网络层：控制平面

 

